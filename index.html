<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLMS Command Center</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- 3. Recharts -->
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
    
    <!-- 4. Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 5. Confetti for Gamification -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- 6. Firebase (Modular via CDN) -->
    <!-- We will import these in the module script below -->

    <style>
        /* Base Themes */
        :root {
            --bg-primary: #020617;
            --bg-glass: rgba(15, 23, 42, 0.7);
            --text-main: #f8fafc;
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.5);
        }

        body.theme-sea {
            --bg-primary: #0c4a6e;
            --bg-glass: rgba(12, 74, 110, 0.6);
            --text-main: #f0f9ff;
            --accent: #06b6d4;
            --accent-glow: rgba(6, 182, 212, 0.5);
            background-image: linear-gradient(to bottom right, #0c4a6e, #0f172a);
        }

        body.theme-light {
            --bg-primary: #f1f5f9;
            --bg-glass: rgba(255, 255, 255, 0.8);
            --text-main: #0f172a;
            --accent: #2563eb;
            --accent-glow: rgba(37, 99, 235, 0.3);
            background-image: linear-gradient(to bottom right, #e2e8f0, #f8fafc);
            color: #0f172a;
        }

        /* Defaults (Cyber Dark) */
        body { 
            background-color: var(--bg-primary); 
            color: var(--text-main); 
            font-family: 'Inter', sans-serif; 
            background-image: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            background-attachment: fixed;
            transition: background 0.5s ease, color 0.5s ease;
        }

        /* Glassmorphism */
        .glass-panel {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            transition: background 0.3s ease;
        }
        body.theme-light .glass-panel {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0,0,0,0.05);
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            color: #0f172a;
        }

        .glass-button {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: inherit;
            transition: all 0.2s ease;
        }
        body.theme-light .glass-button {
            background: white;
            border-color: #cbd5e1;
            color: #475569;
        }
        .glass-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Ticker Animation */
        @keyframes ticker {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .ticker-wrap {
            overflow: hidden;
            white-space: nowrap;
        }
        .ticker-content {
            display: inline-block;
            animation: ticker 30s linear infinite;
        }

        /* Utilities */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 3px; }
        .tv-mode-hide { display: none !important; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Main Application Script -->
    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // --- 1. Firebase Configuration & Utils ---
        const firebaseConfig = JSON.parse('{"apiKey":"","authDomain":"plms-demo.firebaseapp.com","projectId":"plms-demo","storageBucket":"plms-demo.appspot.com","messagingSenderId":"123456789","appId":"1:123456789:web:abcdef"}'); // DUMMY CONFIG FOR TEMPLATE - The environment injects real one usually.
        // NOTE: In this restricted environment, I will use a mock implementation if config is missing, 
        // but for the user's generated file, I will structure it to work with their provided config if they have one, 
        // or default to local storage fallback if firebase fails.
        
        // --- MOCK FIREBASE FOR DEMO (Since we can't inject real keys here) ---
        // In a real deployment, you would replace this Mock logic with real Firebase calls.
        const useMockFirebase = true; 

        // --- React Imports ---
        const { useState, useMemo, useEffect, useRef, createContext, useContext } = React;
        const { ResponsiveContainer, ComposedChart, Bar, Line, Area, AreaChart, XAxis, YAxis, Tooltip, CartesianGrid, Legend, PieChart, Pie, Cell } = Recharts;

        // --- Helpers ---
        const generateRoomCode = () => Math.random().toString(36).substring(2, 6).toUpperCase();
        const round = (n, dp = 2) => Number(n.toFixed(dp));
        const fmtMoney = (n) => n.toLocaleString(undefined, { style: "currency", currency: "USD" });
        const fmtMin = (min) => `${Math.round(min)}m`;
        
        // --- Icons ---
        const Icons = {
            Cloud: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17.5 19c0-3.037-2.463-5.5-5.5-5.5S6.5 15.963 6.5 19"/><path d="M19 19V9l-7-5-7 5v10l7 5 7-5Z" opacity="0"/></svg>, // Simplified
            Wifi: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></svg>,
            Tv: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="20" height="15" x="2" y="7" rx="2" ry="2"/><polyline points="17 2 12 7 7 2"/></svg>,
            Trophy: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
            Zap: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Moon: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            Sun: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2"/><path d="M12 21v2"/><path d="M4.22 4.22l1.42 1.42"/><path d="M18.36 18.36l1.42 1.42"/><path d="M1 12h2"/><path d="M21 12h2"/><path d="M4.22 19.78l1.42-1.42"/><path d="M18.36 5.64l1.42-1.42"/></svg>,
            Settings: (p) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
        };

        // --- Demo Data ---
        const DEMO_DATA = "Date\tLine\tEvent\tDuration\n2025-10-01\tLine A\tMotor Fault\t45\n2025-10-01\tLine A\tJam\t15\n2025-10-02\tLine B\tSensor\t120\n2025-10-02\tLine C\tNo Material\t200\n2025-10-03\tLine A\tCleaning\t30\n2025-10-04\tLine D\tE-Stop\t10";

        // --- Logic Components ---
        
        function App() {
            // State
            const [rawData, setRawData] = useState("");
            const [data, setData] = useState([]);
            const [theme, setTheme] = useState("cyber"); // cyber, sea, light
            const [tvMode, setTvMode] = useState(false);
            const [sessionCode, setSessionCode] = useState("");
            const [isSyncing, setIsSyncing] = useState(false);
            const [activeTab, setActiveTab] = useState("Line A");
            const [costRates, setCostRates] = useState({ "LINE A": 1003.5, "LINE B": 1003.5, "LINE C": 1299.33, "LINE D": 1299.33 });
            
            // Effect: Apply Theme
            useEffect(() => {
                document.body.className = `theme-${theme}`;
            }, [theme]);

            // Parsing Logic (Simplified for brevity)
            const parseData = (text) => {
                const lines = text.trim().split('\n');
                if (lines.length < 2) return [];
                // Simple parser assuming TSV/CSV
                const res = [];
                const headers = lines[0].toLowerCase();
                const isTsv = headers.includes('\t');
                const sep = isTsv ? '\t' : ',';
                
                for(let i=1; i<lines.length; i++) {
                    const cols = lines[i].split(sep);
                    if(cols.length < 4) continue;
                    // Detect columns roughly: Date=0, Line=1, Event=2, Duration=3 (Adjust based on user input usually)
                    // For demo, we assume standard order or try to detect
                    let date = cols[0], line = cols[1], event = cols[2], dur = parseFloat(cols[3]);
                    
                    // Basic normalization
                    if(line && line.toUpperCase().includes('A')) line = "LINE A";
                    else if(line && line.toUpperCase().includes('B')) line = "LINE B";
                    else if(line && line.toUpperCase().includes('C')) line = "LINE C";
                    else if(line && line.toUpperCase().includes('D')) line = "LINE D";
                    else line = "UNKNOWN";

                    let cat = "Other";
                    const e = event.toLowerCase();
                    if(e.includes('motor') || e.includes('sensor') || e.includes('fuse')) cat = "Electrical";
                    else if(e.includes('jam') || e.includes('belt') || e.includes('break')) cat = "Mechanical";
                    else if(e.includes('clean') || e.includes('material')) cat = "Operational";

                    res.push({
                        id: i, date, line, event, duration: dur || 0, category: cat
                    });
                }
                return res;
            };

            const handleAnalyze = (text) => {
                const parsed = parseData(text);
                setData(parsed);
                setRawData(text);
                if(parsed.length > 0) {
                    // Trigger confetti
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                    // Save to cloud if session active
                    if(sessionCode && !useMockFirebase) {
                        // Real firebase logic would go here: setDoc(...)
                    } else if (sessionCode) {
                        // Mock sync
                        localStorage.setItem(`plms_${sessionCode}`, text);
                    }
                }
            };

            // Cloud Sync Simulation
            const joinSession = () => {
                const code = prompt("Enter Room Code (or leave empty to create new):");
                if (code) {
                    setSessionCode(code);
                    setIsSyncing(true);
                    // Mock retrieve
                    const saved = localStorage.getItem(`plms_${code}`);
                    if(saved) handleAnalyze(saved);
                } else {
                    const newCode = generateRoomCode();
                    setSessionCode(newCode);
                    setIsSyncing(true);
                    alert(`Room Created! Code: ${newCode}\nShare this to sync.`);
                }
            };

            // Data Filters
            const filteredData = useMemo(() => {
                return data.filter(d => d.line === activeTab.toUpperCase());
            }, [data, activeTab]);

            // KPIs
            const kpis = useMemo(() => {
                const totalDur = filteredData.reduce((acc, c) => acc + c.duration, 0);
                const cost = (totalDur / 60) * (costRates[activeTab.toUpperCase()] || 1000);
                const count = filteredData.length;
                const mttr = count ? totalDur / count : 0;
                
                // Gamification Score (0-100)
                // Arbitrary formula: 100 - (MTTR/2) - (stops/5)
                let score = 100 - (mttr / 2) - (count / 5);
                if (score < 0) score = 0;
                if (score > 100) score = 100;

                return { totalDur, cost, count, mttr, score };
            }, [filteredData, activeTab]);

            // Badges
            const badges = useMemo(() => {
                const b = [];
                if (kpis.mttr > 0 && kpis.mttr < 30) b.push({ icon: "âš¡", label: "Quick Fixer", color: "text-yellow-400" });
                if (kpis.score > 85) b.push({ icon: "ðŸ†", label: "Elite Line", color: "text-purple-400" });
                if (kpis.count === 0 && data.length > 0) b.push({ icon: "âœ¨", label: "Clean Run", color: "text-emerald-400" });
                return b;
            }, [kpis]);

            // Ticker Items
            const tickerItems = useMemo(() => {
                if (data.length === 0) return ["Waiting for data...", "PLMS Command Center Ready"];
                const topErrors = [...data].sort((a,b) => b.duration - a.duration).slice(0, 3);
                return topErrors.map(e => `ALERT: ${e.line} - ${e.event} (${e.duration}m)`);
            }, [data]);

            return (
                <div className={`min-h-screen pb-10 transition-all ${tvMode ? 'p-0 overflow-hidden' : 'p-4 md:p-8'}`}>
                    
                    {/* TICKER TAPE */}
                    <div className="fixed top-0 left-0 w-full bg-slate-950/80 backdrop-blur-md border-b border-white/10 h-8 flex items-center z-50 overflow-hidden">
                        <div className="bg-indigo-600 px-3 h-full flex items-center text-xs font-bold uppercase tracking-wider text-white z-10">Live Feed</div>
                        <div className="ticker-wrap w-full">
                            <div className="ticker-content text-xs font-mono text-indigo-200">
                                {tickerItems.map((t, i) => <span key={i} className="mx-8">:: {t}</span>)}
                            </div>
                        </div>
                    </div>

                    <div className="max-w-[1800px] mx-auto mt-10">
                        
                        {/* HEADER & CONTROLS (Hidden in TV Mode) */}
                        {!tvMode && (
                            <div className="flex flex-col xl:flex-row justify-between items-end gap-6 mb-10 animate-in">
                                <div>
                                    <h1 className="text-5xl font-black tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 via-purple-400 to-cyan-400 drop-shadow-sm mb-2">
                                        PLMS <span className="text-white/20 font-light">Command</span>
                                    </h1>
                                    <div className="flex items-center gap-4 text-sm text-slate-400">
                                        <button onClick={joinSession} className={`flex items-center gap-2 px-3 py-1 rounded-full border transition-all ${isSyncing ? 'bg-emerald-500/10 border-emerald-500/50 text-emerald-400' : 'hover:bg-white/5 border-white/10'}`}>
                                            <Icons.Wifi className={`w-3 h-3 ${isSyncing ? 'animate-pulse' : ''}`} />
                                            {sessionCode ? `Synced: ${sessionCode}` : 'Offline Mode'}
                                        </button>
                                        <div className="flex items-center gap-2 px-3 py-1 bg-white/5 rounded-full">
                                            <span>Theme:</span>
                                            <button onClick={() => setTheme('cyber')} className={`w-3 h-3 rounded-full bg-indigo-500 ${theme==='cyber'?'ring-2 ring-white':''}`}></button>
                                            <button onClick={() => setTheme('sea')} className={`w-3 h-3 rounded-full bg-cyan-600 ${theme==='sea'?'ring-2 ring-white':''}`}></button>
                                            <button onClick={() => setTheme('light')} className={`w-3 h-3 rounded-full bg-slate-200 ${theme==='light'?'ring-2 ring-white':''}`}></button>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex flex-wrap gap-3">
                                    <button onClick={() => handleAnalyze(DEMO_DATA)} className="glass-button px-5 py-3 rounded-xl font-semibold flex items-center gap-2">
                                        <Icons.Zap className="w-4 h-4 text-yellow-400" /> Demo
                                    </button>
                                    <button onClick={() => { 
                                        const t = prompt("Paste Data:");
                                        if(t) handleAnalyze(t);
                                    }} className="glass-button px-5 py-3 rounded-xl font-semibold">Paste Data</button>
                                    <button onClick={() => setTvMode(true)} className="bg-indigo-600 hover:bg-indigo-500 text-white px-5 py-3 rounded-xl font-semibold shadow-lg shadow-indigo-500/30 flex items-center gap-2">
                                        <Icons.Tv className="w-4 h-4" /> TV Mode
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* TV MODE EXIT BUTTON */}
                        {tvMode && (
                            <button onClick={() => setTvMode(false)} className="fixed bottom-4 right-4 bg-red-500/20 hover:bg-red-500 text-red-200 hover:text-white p-2 rounded-full z-50 transition-all">
                                <Icons.X className="w-6 h-6" />
                            </button>
                        )}

                        {/* LINE SELECTION TABS */}
                        <div className="flex gap-4 mb-8 overflow-x-auto pb-2">
                            {["Line A", "Line B", "Line C", "Line D"].map(l => (
                                <button 
                                    key={l}
                                    onClick={() => setActiveTab(l)}
                                    className={`px-8 py-4 rounded-2xl font-bold text-lg transition-all ${activeTab === l ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-500/40 scale-105' : 'glass-panel text-slate-400 hover:bg-white/10'}`}
                                >
                                    {l}
                                </button>
                            ))}
                        </div>

                        {/* KPI GRID */}
                        <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-6 mb-8">
                            {/* Score Card (Gamified) */}
                            <div className="glass-panel p-6 rounded-2xl xl:col-span-1 relative overflow-hidden group">
                                <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                                    <Icons.Trophy className="w-24 h-24" />
                                </div>
                                <p className="text-slate-400 text-sm font-bold uppercase tracking-wider">Efficiency Score</p>
                                <div className="flex items-end gap-2 mt-2">
                                    <span className={`text-5xl font-black ${kpis.score > 80 ? 'text-emerald-400' : kpis.score > 50 ? 'text-yellow-400' : 'text-red-400'}`}>
                                        {Math.round(kpis.score)}
                                    </span>
                                    <span className="text-sm text-slate-500 mb-2">/ 100</span>
                                </div>
                                <div className="mt-4 flex gap-2">
                                    {badges.map((b, i) => (
                                        <span key={i} className={`text-xs bg-white/5 border border-white/10 px-2 py-1 rounded-full flex items-center gap-1 ${b.color}`}>
                                            {b.icon} {b.label}
                                        </span>
                                    ))}
                                    {badges.length === 0 && <span className="text-xs text-slate-600 italic">No badges earned</span>}
                                </div>
                            </div>

                            <KPICard title="Total Loss" value={fmtMoney(kpis.cost)} sub={`$${costRates[activeTab.toUpperCase()]}/hr`} color="text-red-400" />
                            <KPICard title="Downtime" value={fmtHoursFromMin(kpis.totalDur)} sub={`${fmtMin(kpis.totalDur)} total`} color="text-indigo-400" />
                            <KPICard title="Stops" value={kpis.count} sub="Events" color="text-blue-400" />
                            <KPICard title="MTTR" value={fmtMin(kpis.mttr)} sub="Avg Repair Time" color="text-amber-400" />
                        </div>

                        {/* MAIN DASHBOARD CONTENT */}
                        <div className="grid grid-cols-1 xl:grid-cols-3 gap-6 h-auto xl:h-[600px]">
                            
                            {/* Left: Charts (2/3 width) */}
                            <div className="xl:col-span-2 flex flex-col gap-6">
                                {/* Pareto */}
                                <div className="glass-panel p-6 rounded-2xl flex-1 min-h-[300px]">
                                    <div className="flex justify-between mb-4">
                                        <h3 className="text-xl font-bold text-slate-200">Loss Drivers (Pareto)</h3>
                                        <span className="text-xs bg-indigo-500/20 text-indigo-300 px-2 py-1 rounded">By Duration</span>
                                    </div>
                                    <ResponsiveContainer width="100%" height="85%">
                                        <ComposedChart data={filteredData.sort((a,b)=>b.duration-a.duration).slice(0,10)}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="rgba(255,255,255,0.05)" vertical={false} />
                                            <XAxis dataKey="event" stroke="#64748b" tick={{fill:'#94a3b8', fontSize: 10}} interval={0} height={60} angle={-15} textAnchor="end"/>
                                            <YAxis stroke="#64748b" tick={{fill:'#94a3b8', fontSize: 10}}/>
                                            <Tooltip content={<CustomTooltip />} />
                                            <Bar dataKey="duration" fill="url(#gradBar)" radius={[4,4,0,0]} barSize={50} />
                                            <defs>
                                                <linearGradient id="gradBar" x1="0" y1="0" x2="0" y2="1">
                                                    <stop offset="0%" stopColor="var(--accent)" />
                                                    <stop offset="100%" stopColor="var(--accent)" stopOpacity={0.2} />
                                                </linearGradient>
                                            </defs>
                                        </ComposedChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>

                            {/* Right: Event Log & Category (1/3 width) */}
                            <div className="flex flex-col gap-6">
                                {/* Category Donut */}
                                <div className="glass-panel p-6 rounded-2xl h-[250px] relative">
                                    <h3 className="text-lg font-bold text-slate-200 absolute top-6 left-6">Categories</h3>
                                    <ResponsiveContainer width="100%" height="100%">
                                        <PieChart>
                                            <Pie 
                                                data={Object.values(filteredData.reduce((a,c)=>{
                                                    if(!a[c.category]) a[c.category]={name:c.category, value:0};
                                                    a[c.category].value+=c.duration; return a;
                                                }, {}))} 
                                                innerRadius={60} 
                                                outerRadius={80} 
                                                paddingAngle={5} 
                                                dataKey="value"
                                            >
                                                <Cell fill="#6366f1" />
                                                <Cell fill="#10b981" />
                                                <Cell fill="#f59e0b" />
                                                <Cell fill="#ef4444" />
                                            </Pie>
                                            <Tooltip contentStyle={{background: '#0f172a', border:'none', borderRadius: '8px'}} />
                                            <Legend verticalAlign="middle" align="right" />
                                        </PieChart>
                                    </ResponsiveContainer>
                                </div>

                                {/* Log Table */}
                                <div className="glass-panel rounded-2xl flex-1 overflow-hidden flex flex-col">
                                    <div className="p-4 border-b border-white/10 bg-black/20">
                                        <h3 className="font-bold text-slate-300">Live Log</h3>
                                    </div>
                                    <div className="flex-1 overflow-auto p-2">
                                        <table className="w-full text-left text-sm">
                                            <tbody className="divide-y divide-white/5">
                                                {filteredData.slice(0, 50).map((r) => (
                                                    <tr key={r.id} className="hover:bg-white/5 transition-colors">
                                                        <td className="p-3 text-slate-400 text-xs font-mono">{r.date}</td>
                                                        <td className="p-3 text-slate-200 font-medium">
                                                            {r.event}
                                                            <div className="text-[10px] text-slate-500 uppercase">{r.category}</div>
                                                        </td>
                                                        <td className="p-3 text-right">
                                                            <span className={`px-2 py-1 rounded text-xs font-bold ${r.duration > 60 ? 'bg-red-500/20 text-red-400' : 'bg-slate-800 text-slate-400'}`}>
                                                                {r.duration}m
                                                            </span>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            );
        }

        // Sub-Components
        const KPICard = ({ title, value, sub, color }) => (
            <div className="glass-panel p-6 rounded-2xl relative overflow-hidden group hover:bg-white/5 transition-colors">
                <p className="text-slate-400 text-sm font-bold uppercase tracking-wider">{title}</p>
                <p className={`text-4xl font-black mt-2 tracking-tight ${color}`}>{value}</p>
                <p className="text-slate-500 text-xs mt-1">{sub}</p>
            </div>
        );

        const CustomTooltip = ({ active, payload, label }) => {
            if (active && payload && payload.length) {
                return (
                    <div className="glass-panel p-3 rounded-xl border border-white/20">
                        <p className="font-bold text-white mb-1">{label}</p>
                        <p className="text-indigo-300 text-sm">{payload[0].value} mins lost</p>
                    </div>
                );
            }
            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

